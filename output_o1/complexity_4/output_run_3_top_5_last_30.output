[
  {
    "timestamp": "2025-01-29T14:20:45.413070",
    "response": {
      "id": "chatcmpl-Auy3pDvqvTZak24S0YtwVaka2Tjy0",
      "choices": [
        {
          "finish_reason": "tool_calls",
          "index": 0,
          "logprobs": null,
          "message": {
            "content": null,
            "refusal": null,
            "role": "assistant",
            "audio": null,
            "function_call": null,
            "tool_calls": [
              {
                "id": "call_7tMTlv3wuDln8KKSkGIYSRJT",
                "function": {
                  "arguments": "{\"sql\":\"WITH last_30_open_tickets AS (\\n    -- 1. Fetch the last 30 open tickets\\n    SELECT\\n        st.id,\\n        st.created_at,\\n        st.description,\\n        (SELECT (regexp_matches(st.description,\\n            '([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})'))[1])::uuid AS project_id_extracted\\n    FROM support_ticket st\\n    WHERE st.status = 'open'\\n    ORDER BY st.created_at DESC\\n    LIMIT 30\\n),\\n-- 2. Find the most recent plan name for each ticket's extracted project_id\\nticket_with_plan AS (\\n    SELECT\\n        l30.id,\\n        l30.created_at,\\n        l30.description,\\n        l30.project_id_extracted,\\n        (\\n            SELECT p.name\\n            FROM project_plan_changelogs ppc\\n            JOIN plans p ON ppc.plan_id = p.id\\n            WHERE ppc.project_id = l30.project_id_extracted\\n            ORDER BY ppc.created_at DESC\\n            LIMIT 1\\n        ) AS plan_name\\n    FROM last_30_open_tickets l30\\n),\\n-- 3. Classify tickets into categories based on the description (naive keyword matching)\\nticket_with_classification AS (\\n    SELECT\\n        twp.id,\\n        twp.created_at,\\n        twp.project_id_extracted,\\n        twp.plan_name,\\n        CASE\\n            WHEN twp.description ~* 'widespread service disruption|timeouts|500 errors|outage' THEN 'downtime'\\n            WHEN twp.description ~* 'intermittent connectivity|service instability|random failures' THEN 'reliability'\\n            WHEN twp.description ~* 'performance|latency|slow response|slow queries' THEN 'performance'\\n            WHEN twp.description ~* 'bug|wrong results|unauthorized|error in logic' THEN 'bug'\\n            WHEN twp.description ~* 'feature request|requesting new feature|enhancement' THEN 'feature request'\\n            ELSE 'others'\\n        END AS category,\\n        twp.description\\n    FROM ticket_with_plan twp\\n)\\n-- 4. Sort according to the priority rules:\\n--    1) advanced plan + (downtime/reliability) highest\\n--    2) base plan + (downtime/reliability) next\\n--    3) Then by category order downtime > reliability > performance > bug > feature request > others\\n--    4) Finally, older tickets first\\nSELECT id\\nFROM ticket_with_classification\\nORDER BY\\n    CASE WHEN plan_name = 'advanced' AND category IN ('downtime','reliability') THEN 2\\n         WHEN plan_name = 'base' AND category IN ('downtime','reliability') THEN 1\\n         ELSE 0\\n    END DESC,\\n    CASE category\\n      WHEN 'downtime' THEN 5\\n      WHEN 'reliability' THEN 4\\n      WHEN 'performance' THEN 3\\n      WHEN 'bug' THEN 2\\n      WHEN 'feature request' THEN 1\\n      ELSE 0\\n    END DESC,\\n    created_at ASC\\nLIMIT 5;\"}",
                  "name": "query_support_tickets"
                },
                "type": "function"
              }
            ]
          }
        }
      ],
      "created": 1738140605,
      "model": "o1-2024-12-17",
      "object": "chat.completion",
      "service_tier": "default",
      "system_fingerprint": "fp_d91c966719",
      "usage": {
        "completion_tokens": 4516,
        "prompt_tokens": 1037,
        "total_tokens": 5553,
        "completion_tokens_details": {
          "accepted_prediction_tokens": 0,
          "audio_tokens": 0,
          "reasoning_tokens": 3776,
          "rejected_prediction_tokens": 0
        },
        "prompt_tokens_details": {
          "audio_tokens": 0,
          "cached_tokens": 0
        }
      }
    }
  },
  {
    "timestamp": "2025-01-29T14:20:54.664876",
    "response": {
      "id": "chatcmpl-Auy4TGoiGPZxf4pf1ngoNj8JR2Vpa",
      "choices": [
        {
          "finish_reason": "tool_calls",
          "index": 0,
          "logprobs": null,
          "message": {
            "content": null,
            "refusal": null,
            "role": "assistant",
            "audio": null,
            "function_call": null,
            "tool_calls": [
              {
                "id": "call_2LEeJcb6C87H3e8BpKDBTBet",
                "function": {
                  "arguments": "{\"sql\":\"SELECT id, created_at, description\\nFROM support_ticket\\nWHERE status = 'open'\\nORDER BY created_at DESC\\nLIMIT 30;\"}",
                  "name": "query_support_tickets"
                },
                "type": "function"
              }
            ]
          }
        }
      ],
      "created": 1738140645,
      "model": "o1-2024-12-17",
      "object": "chat.completion",
      "service_tier": "default",
      "system_fingerprint": "fp_d91c966719",
      "usage": {
        "completion_tokens": 886,
        "prompt_tokens": 1821,
        "total_tokens": 2707,
        "completion_tokens_details": {
          "accepted_prediction_tokens": 0,
          "audio_tokens": 0,
          "reasoning_tokens": 832,
          "rejected_prediction_tokens": 0
        },
        "prompt_tokens_details": {
          "audio_tokens": 0,
          "cached_tokens": 0
        }
      }
    }
  },
  {
    "timestamp": "2025-01-29T14:21:48.516274",
    "response": {
      "id": "chatcmpl-Auy4dJiLHoqgHtHWImiBL6KquyMkd",
      "choices": [
        {
          "finish_reason": "tool_calls",
          "index": 0,
          "logprobs": null,
          "message": {
            "content": null,
            "refusal": null,
            "role": "assistant",
            "audio": null,
            "function_call": null,
            "tool_calls": [
              {
                "id": "call_xeoKCHjw05992v7TuTopKHS9",
                "function": {
                  "arguments": "{\"sql\":\"WITH project_ids AS (\\n    SELECT unnest(ARRAY[\\n        '2a8d4b07-c391-450f-8153-f6521f8a20a0',\\n        '76de9616-3d7b-49d7-b909-e154dda91489',\\n        '386d8856-9020-47eb-a21a-2ebe6b81428e',\\n        'd5dc02fc-707a-4084-854a-79f5866d4dd3',\\n        '5ad39764-9b9b-48cb-8819-43ab40694b06',\\n        '9b8f8c9a-7f76-4bc2-95c9-652b13f13a44',\\n        '8edf6e2c-99b6-49af-b342-4aefe811b2f3',\\n        '5f4d1be1-61b7-4b11-ba51-6e9b7f094c82',\\n        'e452f72b-66e1-4c56-ada2-3525ab8fb280',\\n        'b750445e-fba4-4644-b306-1550cfefad8b',\\n        'e75d06e3-6ec1-4649-bc83-7d19cd07fd77',\\n        '4aeefe6f-7dee-4395-82be-6d8e51aea9fd',\\n        '598b3a1b-0166-420f-ac63-fa734cbf5c63',\\n        'c5d9c906-2b61-424e-967b-fa3e27d09d44',\\n        '5267a67e-d8ea-4154-b385-6269b033a471',\\n        'fc2590f9-6bdc-43e3-9984-9246fd96f2dd',\\n        '4e291cdc-0aab-4573-86a4-c82490831964',\\n        '4d76af73-0ea4-4d9f-9247-78ab43a23704',\\n        '4fbe297d-f58e-477e-a6c9-f5c98cb92555',\\n        'eabbc719-c5cb-461c-9144-e531de1b0617',\\n        '9aed3be2-245d-4e1e-9040-5317a8a8daf1',\\n        '529fbeeb-39fe-46bc-9b22-aa898eb82745',\\n        'c73759e8-6f3d-4607-b276-8d61011c124d',\\n        '8ed9b9ee-91e0-4086-a614-2a1a42894b50'\\n    ]::uuid[]) as pid\\n), latest_plans AS (\\n    SELECT ppc.project_id, p.name as plan_name\\n    FROM project_plan_changelogs ppc\\n    JOIN plans p ON ppc.plan_id = p.id\\n    INNER JOIN (\\n        SELECT project_id, max(created_at) AS max_ts\\n        FROM project_plan_changelogs\\n        GROUP BY project_id\\n    ) sub ON ppc.project_id = sub.project_id AND ppc.created_at = sub.max_ts\\n    WHERE ppc.project_id IN (SELECT pid FROM project_ids)\\n)\\nSELECT project_id, plan_name\\nFROM latest_plans;\"}",
                  "name": "query_control_plane_data"
                },
                "type": "function"
              }
            ]
          }
        }
      ],
      "created": 1738140655,
      "model": "o1-2024-12-17",
      "object": "chat.completion",
      "service_tier": "default",
      "system_fingerprint": "fp_d91c966719",
      "usage": {
        "completion_tokens": 5125,
        "prompt_tokens": 6461,
        "total_tokens": 11586,
        "completion_tokens_details": {
          "accepted_prediction_tokens": 0,
          "audio_tokens": 0,
          "reasoning_tokens": 4288,
          "rejected_prediction_tokens": 0
        },
        "prompt_tokens_details": {
          "audio_tokens": 0,
          "cached_tokens": 0
        }
      }
    }
  },
  {
    "timestamp": "2025-01-29T14:24:12.166982",
    "response": {
      "id": "chatcmpl-Auy5UtbpndJX47gDBKvBrz9SDEFdo",
      "choices": [
        {
          "finish_reason": "stop",
          "index": 0,
          "logprobs": null,
          "message": {
            "content": "<tickets>\n224\n264\n193\n246\n178\n</tickets>",
            "refusal": null,
            "role": "assistant",
            "audio": null,
            "function_call": null,
            "tool_calls": null
          }
        }
      ],
      "created": 1738140708,
      "model": "o1-2024-12-17",
      "object": "chat.completion",
      "service_tier": "default",
      "system_fingerprint": "fp_d91c966719",
      "usage": {
        "completion_tokens": 14172,
        "prompt_tokens": 8301,
        "total_tokens": 22473,
        "completion_tokens_details": {
          "accepted_prediction_tokens": 0,
          "audio_tokens": 0,
          "reasoning_tokens": 14144,
          "rejected_prediction_tokens": 0
        },
        "prompt_tokens_details": {
          "audio_tokens": 0,
          "cached_tokens": 6272
        }
      }
    }
  }
]